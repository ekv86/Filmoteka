{"mappings":"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","sources":["src/index.js","src/common.js"],"sourcesContent":["import './sass/index.css';\nimport { getAllFilms, getFilmDetails } from './api';\nimport { getGenres } from './api';\nimport { getSearchFilms } from './api';\nimport { createMarkupDetails } from './markup';\nimport { createMarkupFilms } from './markup';\nimport { useModal } from './use_modal';\nimport { common } from './common';\n\n\nconst filmListEl = document.querySelector('.js-film_list');\nconst filmFormEl = document.querySelector('.js-film-form');\nconst paginationEl = document.querySelector('.pagination');\nconst paginationListEl = document.querySelector('.js-pagination__list');\nconst prevPageEl = document.querySelector(\".js-pagination__arrow_prev\");\nconst nextPageEl = document.querySelector(\".js-pagination__arrow_next\");\nconst backdropDescriptionEl = document.querySelector('.backdrop__description');\nconst btnAddWatchEl = document.querySelector('.js-btn-watch');\nconst btnAddQueEl = document.querySelector('.js-btn-que');\nconst errorEl = document.querySelector(\".js-error\");\nconst errorSearchEl = document.querySelector('.js-error_search');\nconst loaderEl = document.querySelector('.loader');\n\nlet currentPage = 1;\nlet viewedFilm = {};\nlet watchFilmArr = JSON.parse(localStorage.getItem(common.keyWatchFilm)) ?? [];\nlet queFilmArr = JSON.parse(localStorage.getItem(common.keyQueFilm)) ?? [];\n\nfilmFormEl.addEventListener('submit', onSubmitForm);\nfilmListEl.addEventListener('click', onFilmClick);\nbtnAddQueEl.addEventListener('click', onAddQueClick);\nbtnAddWatchEl.addEventListener('click', onAddWatchClick);\n\n\nfunction fetchError() {\n    errorEl.style.display = \"block\";\n    prevPageEl.style.display = \"none\";\n    nextPageEl.style.display = \"none\";\n    loaderEl.style.display = 'none';\n}\n\nfunction searchError() {\n    errorSearchEl.style.display = \"block\";\n}\n\ngetAllFilms()\n    .then((data) => {\n        filmListEl.insertAdjacentHTML('beforeend', createMarkupFilms(data.results));\n        console.log(data.results)\n        findGenres(data.results);\n        pagination();\n        loaderEl.style.display = 'none';\n    })\n    .catch(() => {\n        fetchError();\n    });\n\n\nfunction findGenres(arr) {\n    getGenres().then((genres) => {\n        let filmsGenres = filmListEl.getElementsByClassName('filmsGenres');\n        let genresArr = []\n\n        for (let i = 0; i < genres.genres.length; i += 1) {\n            let genreArr = [];\n            for (let j = 0; j < arr.length; j += 1) {\n                genreArr.splice(0, genreArr.length);\n                arr[j].genre_ids.forEach(function (number) {\n                    let genre = genres.genres.find(genre => genre.id === number);\n                    genreArr.push(genre.name);\n                })\n\n                genresArr.push(genreArr.join(', '))\n            }\n        }\n        for (let i = 0; i < filmsGenres.length; i += 1) {\n            filmsGenres[i].textContent = genresArr[i];\n        }\n    })\n        .catch(() => {\n            fetchError();\n        })\n}\n\nfunction onFilmClick(evt) {\n    if (evt.target === filmListEl) {\n        return\n    }\n    let filmId = evt.target.closest('.films__item').dataset.id;\n    useModal();\n    getFilmDetails(filmId)\n        .then((data) => {\n            backdropDescriptionEl.innerHTML = createMarkupDetails(data);\n            viewedFilm = data;\n            loaderEl.style.display = 'none';\n        })\n        .catch(() => {\n            fetchError();\n        });\n    viewedFilm = {};\n}\n\nif (filmFormEl[0].value) {\n    window.addEventListener('keydown', onEscPress);\n\n    function onEscPress(evt) {\n        if (evt.code === 'Enter') {\n            onSubmitForm();\n        }\n\n        if (!filmFormEl[0].value) {\n            window.removeEventListener('keydown', onEscPress);\n        }\n        console.log(evt.code)\n    }\n}\n\nfunction onSubmitForm(evt) {\n    evt.preventDefault();\n    paginationEl.style.display = \"none\";\n    errorSearchEl.style.display = \"none\";\n\n    let currentSearch = evt.currentTarget.searchQuery.value;\n    let optimizationArr = currentSearch.toLowerCase().split(\" \");\n    for (let i = 0; i < optimizationArr.length; i += 1) {\n        optimizationArr[i] = optimizationArr[i][0].toUpperCase() + optimizationArr[i].substr(1);\n    }\n    let optimizationString = optimizationArr.join(\" \");\n\n    getSearchFilms(optimizationString)\n        .then((data) => {\n            console.log(data)\n            filmListEl.innerHTML = createMarkupFilms(data.results);\n            findGenres(data.results);\n\n            data.results.forEach(function (el) {\n                if (!el.poster_path) {\n                    throw new Error('There is no picture');\n                }\n            })\n\n            if (!data.total_results) {\n                throw new searchError();\n            }\n            filmListEl.innerHTML = \"\";\n            loaderEl.style.display = 'none';\n        })\n        .catch(() => {\n            console.log('There is no picture');\n        });\n    evt.currentTarget.searchQuery.value = '';\n}\n\nfunction onAddWatchClick() {\n    const inStorage = watchFilmArr.some(({ id }) => id === viewedFilm.id);\n    if (inStorage) {\n        return\n    }\n    watchFilmArr.push(viewedFilm);\n    localStorage.setItem(common.keyWatchFilm, JSON.stringify(watchFilmArr));\n}\n\nfunction onAddQueClick() {\n    const inStorage = queFilmArr.some(({ id }) => Number(id) === viewedFilm.id);\n    if (inStorage) {\n        return\n    }\n\n    queFilmArr.push(viewedFilm);\n    localStorage.setItem(common.keyQueFilm, JSON.stringify(queFilmArr));\n}\n\nfunction pagination() {\n    getAllFilms()\n        .then((data) => {\n            for (let i = 1; i <= data.total_pages; i += 1) {\n                let liEl = document.createElement(\"li\");\n                liEl.classList.add(\"pagination__item\");\n                liEl.classList.add(\"text\");\n                liEl.textContent = i;\n                paginationListEl.appendChild(liEl);\n            }\n\n            let active;\n            showPage(paginationListEl.children[0]);\n\n            for (let item of paginationListEl.children) {\n                item.addEventListener(\"click\", function () {\n                    showPage(this);\n                });\n            }\n\n            function showPage(item) {\n                if (active) {\n                    active.classList.remove(\"active\");\n                }\n                active = item;\n                item.classList.add(\"active\");\n                currentPage = item.textContent;\n\n                getAllFilms(currentPage)\n                    .then((data) => {\n                        filmListEl.insertAdjacentHTML('beforeend', createMarkupFilms(data.results));\n                        findGenres(data.results);\n                        loaderEl.style.display = 'none';\n                    })\n                    .catch(() => {\n                        fetchError();\n                        paginationEl.style.display = \"none\";\n                    });\n                filmListEl.innerHTML = \"\";\n                hideOverPages();\n            }\n\n            nextPageEl.addEventListener(\"click\", onNextPageClick);\n            prevPageEl.addEventListener(\"click\", onPrevPageClick);\n\n            function onNextPageClick() {\n                if (active.nextElementSibling) {\n                    showPage(active.nextElementSibling);\n                }\n            }\n\n            function onPrevPageClick() {\n                if (active.previousElementSibling) {\n                    showPage(active.previousElementSibling);\n                }\n            }\n\n            function hideOverPages() {\n                let items = [...paginationListEl.children];\n                if (items.length > 5) {\n                    items.forEach((item) => item.classList.add(\"hide\"));\n                    items[0].classList.remove(\"hide\");\n                    try {\n                        if (active.previousElementSibling) {\n                            active.previousElementSibling.classList.remove(\"hide\");\n                            active.previousElementSibling.previousElementSibling.classList.remove(\"hide\");\n                        }\n\n                        active.classList.remove(\"hide\");\n                        if (active.nextElementSibling) {\n                            active.nextElementSibling.classList.remove(\"hide\");\n                            active.nextElementSibling.nextElementSibling.classList.remove(\"hide\");\n                        }\n                    }\n                    catch {\n                        if (active.previousElementSibling) {\n                            active.previousElementSibling.classList.remove(\"hide\");\n                        }\n\n                        active.classList.remove(\"hide\");\n                        if (active.nextElementSibling) {\n                            active.nextElementSibling.classList.remove(\"hide\");\n                        }\n                    }\n                }\n            }\n        })\n        .catch(error => console.log(error));\n}","export const common = {\n    keyWatchFilm: 'watchFilm',\n    keyQueFilm: 'queFilm'\n}"],"names":["$b8f9b7833fa37166$var$ref","$b8f9b7833fa37166$var$ref1","$8nrFW","parcelRequire","$553dc769982d198b$export$919daad019702595","keyWatchFilm","keyQueFilm","$b8f9b7833fa37166$var$filmListEl","document","querySelector","$b8f9b7833fa37166$var$filmFormEl","$b8f9b7833fa37166$var$paginationEl","$b8f9b7833fa37166$var$paginationListEl","$b8f9b7833fa37166$var$prevPageEl","$b8f9b7833fa37166$var$nextPageEl","$b8f9b7833fa37166$var$backdropDescriptionEl","$b8f9b7833fa37166$var$btnAddWatchEl","$b8f9b7833fa37166$var$btnAddQueEl","$b8f9b7833fa37166$var$errorEl","$b8f9b7833fa37166$var$errorSearchEl","$b8f9b7833fa37166$var$loaderEl","$b8f9b7833fa37166$var$currentPage","$b8f9b7833fa37166$var$viewedFilm","$b8f9b7833fa37166$var$watchFilmArr","JSON","parse","localStorage","getItem","$b8f9b7833fa37166$var$queFilmArr","$b8f9b7833fa37166$var$fetchError","style","display","$b8f9b7833fa37166$var$searchError","$b8f9b7833fa37166$var$findGenres","arr","$446fK","getGenres","then","genres","filmsGenres","getElementsByClassName","genresArr","i","length","genreArr","j","splice","genre_ids","forEach","number","genre1","find","genre","id","push","name","join","i1","textContent","catch","addEventListener","$b8f9b7833fa37166$var$onSubmitForm","evt","target","filmId","closest","dataset","$a5TQa","useModal","getFilmDetails","data","innerHTML","$knNGv","createMarkupDetails","some","param","Number","setItem","stringify","getAllFilms","insertAdjacentHTML","createMarkupFilms","results","console","log","data1","total_pages","liEl","createElement","classList","add","appendChild","active","showPage","children","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","value","this","err","return","item","remove","hideOverPages","onNextPageClick","nextElementSibling","onPrevPageClick","previousElementSibling","items","$parcel$interopDefault","e","error","window","$b8f9b7833fa37166$var$onEscPress","code","removeEventListener","preventDefault","optimizationArr","currentTarget","searchQuery","toLowerCase","split","toUpperCase","substr","optimizationString","getSearchFilms","el","poster_path","Error","total_results"],"version":3,"file":"index.525c4213.js.map"}